<html lang="zh-TW"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>冬日北陸四城之旅 | 互動式旅遊規劃</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: Noto Sans TC -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&amp;display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #F8FAFC; /* Light Gray */
            color: #334155; /* Slate */
        }
        .theme-teal { color: #14B8A6; }
        .bg-theme-teal { background-color: #14B8A6; }
        .border-theme-teal { border-color: #14B8A6; }
        
        html { scroll-behavior: smooth; }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
            height: 300px;
            max-height: 300px;
        }

        .card-bg-light {
            background-color: #FFFFFF;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .timeline-node {
            transition: all 0.3s ease-in-out;
            cursor: pointer;
        }
        .timeline-line {
            z-index: 0;
        }

        /* Choice Card Styles */
        .choice-card {
            border: 2px solid #E2E8F0;
            transition: all 0.2s;
        }
        .choice-card.selected {
            border-color: #14B8A6;
            background-color: #F0FDFA;
            box-shadow: 0 0 0 2px rgba(20, 184, 166, 0.2);
        }
        
        .map-wrapper {
            margin-bottom: 2.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-radius: 0.75rem;
            overflow: hidden;
            background-color: #ffffff;
        }
        .map-wrapper img {
            width: 100%;
            height: auto;
            display: block;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center">
                    <i class="fa-solid fa-map-marked-alt text-2xl theme-teal mr-2"></i>
                    <span class="font-bold text-xl tracking-wide text-gray-700">冬日北陸四城之旅</span>
                </div>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#dashboard" class="text-gray-600 hover:text-[#14B8A6] transition font-medium">總覽數據</a>
                    <a href="#itinerary" class="text-gray-600 hover:text-[#14B8A6] transition font-medium">每日行程</a>
                    <a href="#food" class="text-gray-600 hover:text-[#14B8A6] transition font-medium">美食地圖</a>
                    <a href="#logistics" class="text-gray-600 hover:text-[#14B8A6] transition font-medium">住宿交通</a>
                </div>
                <div class="md:hidden flex items-center">
                    <button id="mobile-menu-btn" class="text-gray-600 focus:outline-none">
                        <i class="fa-solid fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t p-4 flex flex-col space-y-3 shadow-lg">
            <a href="#dashboard" class="mobile-link block px-3 py-2 rounded-md text-base font-medium hover:bg-teal-50 text-gray-700">總覽數據</a>
            <a href="#itinerary" class="mobile-link block px-3 py-2 rounded-md text-base font-medium hover:bg-teal-50 text-gray-700">每日行程</a>
            <a href="#food" class="mobile-link block px-3 py-2 rounded-md text-base font-medium hover:bg-teal-50 text-gray-700">美食地圖</a>
            <a href="#logistics" class="mobile-link block px-3 py-2 rounded-md text-base font-medium hover:bg-teal-50 text-gray-700">住宿交通</a>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="relative bg-white shadow-inner">
        <div class="max-w-7xl mx-auto py-16 px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-4xl font-extrabold text-[#334155] tracking-tight mb-3">名古屋．高山．富山．金澤</h1>
            <p class="text-xl theme-teal font-semibold mb-6">10天9夜 冬日北陸之旅 (2025/12/22 ~ 12/31)</p>
            <div class="flex flex-wrap justify-center gap-4 text-sm text-gray-600">
                <span class="bg-teal-50 px-4 py-1.5 rounded-full font-medium"><i class="fa-solid fa-users mr-2 theme-teal"></i>4位成員 (聖叡、淑琪、嬸嬸、媽媽)</span>
                <span class="bg-teal-50 px-4 py-1.5 rounded-full font-medium"><i class="fa-solid fa-mountain-sun mr-2 theme-teal"></i>行程風格：輕鬆慢活</span>
            </div>
        </div>
    </header>

    <!-- Dashboard Section -->
    <section id="dashboard" class="py-16 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <div class="mb-6">
             <h3 class="text-2xl font-bold text-gray-800 border-l-4 border-[#14B8A6] pl-4">北陸四城 10日遊地圖</h3>
        </div>

        <div class="map-wrapper">
            <img src="https://i.meee.com.tw/FadENbA.png" alt="冬日北陸之旅地圖" class="">
        </div>

        <div class="mb-10">
            <h2 class="text-3xl font-bold text-gray-800 border-l-4 border-[#14B8A6] pl-4">行程總覽與費用預算 (TWD)</h2>
            <p class="mt-3 text-gray-500">此圖表為動態互動式，當您在行程中切換不同餐廳選項時，總預算會即時更新。</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
            <!-- Chart 1: Total Budget Breakdown -->
             <div class="card-bg-light p-6 shadow-xl border border-gray-100">
                <h3 class="text-xl font-semibold mb-4 text-center text-gray-700">總預算分類估算 (4人份總計)</h3>
                <div class="chart-container h-[350px] max-h-[350px]">
                    <canvas id="budgetChart"></canvas>
                </div>
                <div class="mt-6 text-center text-sm text-gray-500 bg-teal-50 p-3 rounded-lg">
                    <p id="total-budget-display"><i class="fa-solid fa-coins mr-1 theme-teal"></i> 計算中...</p>
                </div>
            </div>

            <!-- Chart 2: Travel Time -->
            <div class="card-bg-light p-6 shadow-xl border border-gray-100">
                <h3 class="text-xl font-semibold mb-4 text-center text-gray-700">主要交通移動耗時 (小時)</h3>
                <div class="chart-container h-[350px] max-h-[350px]">
                    <canvas id="timeChart"></canvas>
                </div>
                <div class="mt-6 text-center text-sm text-gray-500 bg-teal-50 p-3 rounded-lg">
                    <p><i class="fa-solid fa-clock mr-1 theme-teal"></i> 最長的移動日 (白川鄉轉乘日) 需注意班次銜接。</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Itinerary Section -->
    <section id="itinerary" class="py-16 bg-white">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-10">
                <h2 class="text-3xl font-bold text-gray-800 border-l-4 border-[#14B8A6] pl-4">每日行程精華</h2>
                <p class="mt-3 text-gray-500">Day 3, 4, 5 包含互動式餐廳選擇，點擊選項可即時更新行程與預算。</p>
            </div>

            <div id="full-itinerary-container" class="space-y-6">
                <!-- Javascript will populate this container -->
            </div>
        </div>
    </section>

    <!-- Food Map Section -->
    <section id="food" class="py-16 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="mb-10">
            <h2 class="text-3xl font-bold text-gray-800 border-l-4 border-[#14B8A6] pl-4">美食口袋名單與地圖</h2>
            <p class="mt-3 text-gray-500">已更新富山冰見推薦美食 (ばんや料理 ひみ浜、亀寿し)，點擊下方按鈕篩選。</p>
        </div>

        <div class="flex flex-wrap gap-3 mb-10 justify-center">
            <button class="filter-btn active px-5 py-2 rounded-full text-sm font-semibold transition bg-[#14B8A6] text-white shadow-md hover:bg-teal-600" data-filter="all">全部美食</button>
            <button class="filter-btn px-5 py-2 rounded-full text-sm font-semibold transition bg-white text-gray-600 border border-gray-300 hover:bg-teal-50" data-filter="nagoya">名古屋</button>
            <button class="filter-btn px-5 py-2 rounded-full text-sm font-semibold transition bg-white text-gray-600 border border-gray-300 hover:bg-teal-50" data-filter="takayama">高山</button>
            <button class="filter-btn px-5 py-2 rounded-full text-sm font-semibold transition bg-white text-gray-600 border border-gray-300 hover:bg-teal-50" data-filter="toyama">富山/冰見</button>
            <button class="filter-btn px-5 py-2 rounded-full text-sm font-semibold transition bg-white text-gray-600 border border-gray-300 hover:bg-teal-50" data-filter="kanazawa">金澤</button>
            <button class="filter-btn px-5 py-2 rounded-full text-sm font-semibold transition bg-white text-gray-600 border border-gray-300 hover:bg-teal-50" data-filter="main">正餐/主食</button>
            <button class="filter-btn px-5 py-2 rounded-full text-sm font-semibold transition bg-white text-gray-600 border border-gray-300 hover:bg-teal-50" data-filter="sweet">甜點/小吃</button>
        </div>

        <div id="restaurant-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Javascript will populate this -->
        </div>
    </section>

    <!-- Logistics Section -->
    <section id="logistics" class="py-16 bg-[#F0F4F8]">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
                
                <!-- Col 1: Accommodation -->
                <div class="lg:col-span-1">
                    <h2 class="text-3xl font-bold text-gray-800 border-l-4 border-[#14B8A6] pl-4 mb-8">住宿資訊 (9晚, TWD)</h2>
                    <div class="space-y-6">
                        <div class="card-bg-light p-6 shadow-md border border-l-8 border-yellow-500">
                            <h3 class="font-extrabold text-xl text-gray-800 mb-1">名古屋市筒井町 STAY</h3>
                            <p class="text-sm text-gray-600 mb-2"><i class="fa-solid fa-calendar-alt mr-1"></i> 12/22-24 (2晚)</p>
                            <p class="text-sm text-gray-500 font-bold"><i class="fa-solid fa-sack-dollar mr-1"></i> 總花費: $13,019</p>
                        </div>

                        <div class="card-bg-light p-6 shadow-md border border-l-8 border-green-600">
                            <h3 class="font-extrabold text-xl text-gray-800 mb-1">HOTEL AMANEK Hida Takayama</h3>
                            <p class="text-sm text-gray-600 mb-2"><i class="fa-solid fa-calendar-alt mr-1"></i> 12/24-26 (2晚)</p>
                            <p class="text-sm text-gray-500 font-bold"><i class="fa-solid fa-sack-dollar mr-1"></i> 總花費: $8,502</p>
                        </div>

                        <div class="card-bg-light p-6 shadow-md border border-l-8 border-blue-600">
                            <h3 class="font-extrabold text-xl text-gray-800 mb-1">海風〜nami no oto〜</h3>
                            <p class="text-sm text-gray-600 mb-2"><i class="fa-solid fa-calendar-alt mr-1"></i> 12/26-27 (1晚)</p>
                            <p class="text-sm text-gray-500 font-bold"><i class="fa-solid fa-sack-dollar mr-1"></i> 預估: $5,299</p>
                            <a href="https://www.google.com/maps/place/%E6%B5%B7%E9%A2%A8%E3%80%9Cnami+no+oto%E3%80%9C/@36.8500122,136.9865966,15.5z/data=!4m14!1m7!3m6!1s0x5ff773ebb32cbc75:0x3f14d288d1029e2d!2z5rW36aKo44CcbmFtaSBubyBvdG_jgJw!8m2!3d36.8509456!4d136.9921995!16s%2Fg%2F11y22c_zq4?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" target="_blank" class="text-blue-500 text-sm font-medium mt-3 inline-block hover:underline">查看地圖 <i class="fa-solid fa-external-link-alt text-xs"></i></a>
                        </div>

                        <div class="card-bg-light p-6 shadow-md border border-l-8 border-indigo-600">
                            <h3 class="font-extrabold text-xl text-gray-800 mb-1">清蓮 Le Lotus Bleu</h3>
                            <p class="text-sm text-gray-600 mb-2"><i class="fa-solid fa-calendar-alt mr-1"></i> 12/27-29 (2晚)</p>
                            <p class="text-sm text-gray-500 font-bold"><i class="fa-solid fa-sack-dollar mr-1"></i> 總花費: $12,527</p>
                        </div>
                        
                        <div class="card-bg-light p-6 shadow-md border border-l-8 border-yellow-500">
                            <h3 class="font-extrabold text-xl text-gray-800 mb-1">Compass Hotel Nagoya</h3>
                            <p class="text-sm text-gray-600 mb-2"><i class="fa-solid fa-calendar-alt mr-1"></i> 12/29-31 (2晚)</p>
                            <p class="text-sm text-gray-500 font-bold"><i class="fa-solid fa-sack-dollar mr-1"></i> 總花費: $11,154</p>
                        </div>
                    </div>
                </div>

                <!-- Col 2: Transport -->
                <div class="lg:col-span-1">
                    <h2 class="text-3xl font-bold text-gray-800 border-l-4 border-[#14B8A6] pl-4 mb-8">關鍵長途交通接駁</h2>
                    <ul class="space-y-4 text-gray-700">
                        <li class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-red-500">
                            <p class="font-bold">NGO ⇋ 名古屋市區</p>
                            <p class="text-sm text-gray-600">名鐵特急/μ-SKY: ~ $286 TWD</p>
                        </li>
                        <li class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-orange-500">
                            <p class="font-bold">名古屋/犬山 ⇋ 高山</p>
                            <p class="text-sm text-gray-600">JR 飛驒特急 (經轉乘): ~ $1,122 TWD</p>
                        </li>
                        <li class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-blue-500">
                            <p class="font-bold">高山 ⇋ 富山</p>
                            <p class="text-sm text-gray-600">JR 高山本線: ~ $700 TWD</p>
                        </li>
                        <li class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-yellow-500">
                            <p class="font-bold">富山 ⇋ 冰見 ⇋ 白川鄉</p>
                            <p class="text-sm text-gray-600">冰見線+加越能巴士: ~ $600 TWD</p>
                        </li>
                        <li class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-green-500">
                            <p class="font-bold">白川鄉 ⇋ 金澤</p>
                            <p class="text-sm text-gray-600">高速巴士直達: ~ $520 TWD</p>
                        </li>
                         <li class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-indigo-500">
                            <p class="font-bold">金澤 ⇋ 名古屋</p>
                            <p class="text-sm text-gray-600">JR 特急 Shirasagi: ~ $1,970 TWD</p>
                        </li>
                    </ul>
                </div>

                 <!-- Col 3: Entry Tickets -->
                <div class="lg:col-span-1">
                    <h2 class="text-3xl font-bold text-gray-800 border-l-4 border-[#14B8A6] pl-4 mb-8">景點門票總覽 (TWD)</h2>
                    <p class="text-sm text-gray-500 mb-2">已移除飛驒之里門票費用。</p>
                    <ul class="space-y-4 text-gray-700">
                        <li class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-green-600">
                            <p class="font-bold text-lg text-green-700">總門票估算 (4人合計)</p>
                            <p class="text-2xl font-extrabold text-green-800 mt-1" id="total-entry-display">$2,400 TWD</p>
                        </li>
                        <li class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-green-500">
                            <p class="font-bold">富山玻璃美術館</p>
                            <p class="text-sm text-gray-600">常設展: 200 JPY/人</p>
                        </li>
                         <li class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-green-500">
                            <p class="font-bold">犬山城 (550 JPY)</p>
                        </li>
                        <li class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-green-500">
                            <p class="font-bold">高山陣屋 (440 JPY)</p>
                        </li>
                        <li class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-green-500">
                            <p class="font-bold">兼六園 (320 JPY)</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-[#334155] text-white py-8 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="mb-2 text-lg font-medium"><i class="fa-solid fa-map-pin theme-teal mr-2"></i> 名古屋．高山．富山．金澤 — 完美回憶</p>
            <p class="text-gray-400 text-sm">Designed for You</p>
        </div>
    </footer>

    <script>
        const JPY_TWD_RATE = 0.20;
        const GROUP_SIZE = 4;
        let chartInstance = null;
        
        // 設定初始展開狀態為空
        let openedDays = new Set(); 

        // Cost Dictionary
        const COSTS = {
            // Updated Accommodation: Hotel Enoe (3500) replaced by Nami no Oto (5299)
            ACCOMMODATION: 13019 + 8502 + 5299 + 12527 + 11154,
            TRANSPORT: {
                NGO_NAGOYA: 1430,
                NAGOYA_TAKAYAMA: 5610,
                TAKAYAMA_TOYAMA: 3500,
                // Updated: Added round trip to Amaharashi (approx 1500 JPY/person) + Himi
                TOYAMA_LOCAL: 600 + 1500, 
                TAKAOKA_SHIRAKAWA: 2500,
                // Removed Shinkansen, Added Bus
                SHIRAKAWA_KANAZAWA: 2600, 
                KANAZAWA_NAGOYA: 9850,
            },
            DINING: {
                熱田蓬萊軒: 4600,
                仙石すし本店: 2500,
                麵屋獅子丸: 1600,
                矢場味噌豬排: 2500, 
                馬喰一代午餐: 3500, 
                金澤關東煮赤玉本店: 4000, 
                金澤海鮮井近江町: 3000, 
                金澤蕎麥麵: 2000, 
                犬山城下町輕食: 1500, 
                白川鄉簡餐: 1800, 
                FUMIYA_DINNER: 2500,
                KASU_HANAGURUMA_BREAKFAST: 1000, 
                KOMA_COFFEE: 800, 
                TAKOYAKI_SAGO: 500, 
                ANDERSEN_BREAKFAST: 800, 
                SANMACHI_RAMEN: 1200, 
                飛驒牛握壽司_重兵衛: 1000,
                高山林盛堂_點心: 500,
                石川屋本舖_點心: 500,
                GENERAL_MEAL_LIGHT: 1500, 
                GENERAL_MEAL_STANDARD: 2500,
                SHIN_TONKATSU: 2000,
                MENYA_IROHA: 1100, 
                TANAKA_YA: 2000,
                OCHUDO_TEA: 800,
                MIDOUEN: 7000,
                SEVEN_ELEVEN: 700
            },
            ENTRY: {
                犬山城: 550,
                德川園: 300,
                熱田神宮: 0, 
                高山陣屋: 440,
                飛驒之里: 0, 
                兼六園: 320,
                TOYAMA_GLASS: 200, 
            },
            // Options Costs
            OPTIONS: {
                day3: { option1: 5500, option2: 4500 }, // Ajikura vs Maruaki
                day4: { option1: 3000, option2: 3000 }, // Ebiya vs Sumiku
                day5: { option1: 11000, option2: 5000 } // Himihama vs Kame Sushi
            }
        };

        // User Choices State
        const userChoices = {
            day3: 'option1', // Default
            day4: 'option1', // Default
            day5: 'option1'  // Default
        };

        // Itinerary Data
        const itineraryData = [
            { 
                day: 1, 
                date: "12/22 (一)", 
                title: "抵達名古屋", 
                events: [
                { time: "14:50", title: "高雄起飛", type: "transport", desc: "台灣虎航 IT268", icon: "fa-plane" },
                { time: "18:50", title: "抵達名古屋中部機場", type: "transport", desc: "入境手續、領取行李", icon: "fa-passport" },
                { time: "20:00", title: "搭乘名鐵前往市區", type: "transport", desc: "名鐵 μ-SKY", icon: "fa-train" },
                { time: "21:00", title: "飯店 Check-in", type: "stay", desc: "名古屋市筒井町 STAY", icon: "fa-bed", link: "https://www.google.com/maps/place/筒井町STAY/@35.1719656,136.9189238,15.25z/data=!4m11!3m10!1s0x600371e46d2b6bfd:0x2b7c729dbc15be94!5m4!1s2025-12-26!2i2!4m1!1i2!8m2!3d35.1777401!4d136.9312411!16s%2Fg%2F11l2q91mcm?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
                { time: "22:00", title: "晚餐: ふみ屋 錦店", type: "food", desc: "居酒屋餐點", icon: "fa-utensils", link: "https://www.google.com/maps/search/?api=1&query=ふみ屋+錦店+名古屋" }
            ]},
            { 
                day: 2, 
                date: "12/23 (二)", 
                title: "熱田神宮參拜與市區巡禮", 
                events: [
                { time: "08:00", title: "早餐: コーヒーハウス かこ 花車本店", type: "food", desc: "名古屋特色小倉吐司", icon: "fa-mug-hot", link: "https://www.google.com/maps/search/?api=1&query=コーヒーハウス+かこ+花車本店" },
                { time: "09:00", title: "熱田神宮", type: "spot", desc: "莊嚴參拜 (免門票)", icon: "fa-torii-gate", link: "https://www.google.com/maps/search/?api=1&query=Atsuta+Jingu" },
                { time: "12:00", title: "午餐: 熱田蓬萊軒", type: "food", desc: "鰻魚飯三吃", icon: "fa-utensils", link: "https://www.google.com/maps/search/?api=1&query=Atsuta+Houraiken" },
                { time: "15:00", title: "德川園", type: "spot", desc: "日式庭園散策", icon: "fa-tree", link: "https://www.google.com/maps/search/?api=1&query=Tokugawaen" },
                { time: "18:30", title: "晚餐: 麵屋獅子丸", type: "food", desc: "濃郁雞白湯拉麵", icon: "fa-bowl-food", link: "https://www.google.com/maps/search/?api=1&query=Menya+Shishimaru" }
            ]},
            { 
                day: 3, 
                date: "12/24 (三)", 
                title: "犬山城古都漫遊 & 前往高山", 
                events: [
                { time: "08:30", title: "早餐: 7-ELEVEN", type: "food", desc: "筒井町 STAY 旁邊便利商店 (餐後退房)", icon: "fa-mug-hot", link: "https://www.google.com/maps/place/%E8%B6%85%E5%95%86+7-ELEVEN/@35.1779698,136.930956,19.83z/data=!4m6!3m5!1s0x600370e4d8a7e1f5:0xbaa1508092d19f06!8m2!3d35.1777975!4d136.9310102!16s%2Fg%2F1wk4c_3p?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
                { time: "09:34", title: "前往犬山城", type: "transport", desc: "搭乘地鐵與名鐵前往犬山", icon: "fa-train", link: "https://www.google.com/maps/dir/%E6%97%A5%E6%9C%AC%E3%80%92461-0003+Aichi,+Nagoya,+Higashi+Ward,+Tsutsuicho,+4+Chome%E2%88%9232+%E7%AD%92%E4%BA%95%E7%94%BASTAY/%E6%97%A5%E6%9C%AC%E6%84%9B%E7%9F%A5%E7%B8%A3%E7%8A%AC%E5%B1%B1%E5%B8%82+Inuyama,+Kitakoken+%E7%8A%AC%E5%B1%B1%E5%9F%8E/@35.2671366,136.7425829,11z/am=t/data=!4m18!4m17!1m5!1m1!1s0x600371e46d2b6bfd:0x2b7c729dbc15be94!2m2!1d136.931247!2d35.1777599!1m5!1m1!1s0x60030ef5ad48ed91:0x285afa434603f635!2m2!1d136.9391766!2d35.3883604!2m3!6e0!7e2!8j1766568840!3e3?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
                { time: "11:00", title: "犬山城", type: "spot", desc: "國寶五城之一", icon: "fa-chess-rook", link: "https://www.google.com/maps/search/?api=1&query=Inuyama+Castle" },
                { time: "12:30", title: "午餐: 犬山城下町多樣小吃", type: "food", desc: "壽俵屋壽司、串炸、串燒", icon: "fa-bowl-food", link: "https://www.google.com/maps/search/?api=1&query=犬山城下町" },
                { time: "14:55", title: "前往高山", type: "transport", desc: "名鐵犬山線轉乘JR高山本線", icon: "fa-train", link: "https://www.google.com/maps/dir/%E7%8A%AC%E5%B1%B1%E5%9F%8E%E4%B8%8B%E7%94%BA+Inuyama,+Aichi+484-0083%E6%97%A5%E6%9C%AC/%E6%97%A5%E6%9C%AC%E5%B2%90%E9%98%9C%E7%B8%A3%E9%AB%98%E5%B1%B1%E5%B8%82+Hanasatomachi,+4+Chome%E2%88%92%EF%BC%97%EF%BC%95%E7%95%AA%E5%9C%B0%EF%BC%93+%E3%83%9B%E3%83%86%E3%83%AB%E3%82%A2%E3%83%9E%E3%83%8D%E3%82%AF%E9%A3%9B%E9%A8%A8%E9%AB%98%E5%B1%B1/@35.6548584,136.3678403,9z/am=t/data=!4m18!4m17!1m5!1m1!1s0x60030f11aa5f8fe5:0x2646d20f043a3ed8!2m2!1d136.93944!2d35.383611!1m5!1m1!1s0x6002bb80c5e96551:0x44a1e8601d84b243!2m2!1d137.2527336!2d36.1390468!2m3!6e0!7e2!8j1766587260!3e3?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
                { time: "17:13", title: "抵達高山 & Check-in", type: "stay", desc: "HOTEL AMANEK Hida Takayama", icon: "fa-bed", link: "https://www.google.com/maps/search/?api=1&query=HOTEL+AMANEK+Hida+Takayama" },
                { 
                    type: "choice", 
                    dayKey: "day3",
                    time: "19:30",
                    title: "晚餐選擇 (互動式)",
                    options: [
                        { id: "option1", name: "味藏天國", desc: "JA直營，飛驒牛品質保證", price: 5500, link: "https://www.google.com/maps/search/?api=1&query=Ajikura+Tengoku" },
                        { id: "option2", name: "丸明 (高山店)", desc: "老字號精肉店直營燒肉", price: 4500, link: "https://www.google.com/maps/search/?api=1&query=Maruaki+Takayama" }
                    ]
                }
            ]},
            { 
                day: 4, 
                date: "12/25 (四)", 
                title: "高山朝市、老街與晚餐", 
                events: [
                { time: "08:00", title: "宮川朝市", type: "spot", desc: "逛早市、買農產品", icon: "fa-carrot", link: "https://www.google.com/maps/search/?api=1&query=Miyagawa+Morning+Market" },
                { time: "08:45", title: "朝市點心巡禮", type: "food", desc: "Koma Coffee、章魚燒、林盛堂", icon: "fa-cookie-bite" },
                { time: "11:15", title: "飛驒高山老街 (三町通)", type: "spot", desc: "老街散步、飛驒牛握壽司", icon: "fa-store", link: "https://www.google.com/maps/search/?api=1&query=Takayama+Old+Town" },
                { time: "12:30", title: "午餐: さんまち (Sanmachi)", type: "food", desc: "在地高山拉麵", icon: "fa-bowl-food", link: "https://www.google.com/maps/search/?api=1&query=Sanmachi+Takayama" },
                { time: "14:30", title: "高山陣屋", type: "spot", desc: "江戶時代官府", icon: "fa-landmark", link: "https://www.google.com/maps/search/?api=1&query=Takayama+Jinya" },
                { 
                    type: "choice", 
                    dayKey: "day4",
                    time: "18:00",
                    title: "晚餐選擇 (互動式)",
                    options: [
                        { id: "option1", name: "えび八 (Ebiya)", desc: "在地人氣現炸天婦羅", price: 3000, link: "https://www.google.com/maps/search/?api=1&query=Ebiya+Takayama" },
                        { id: "option2", name: "寿美久 (Sumiku)", desc: "傳統手打蕎麥麵", price: 3000, link: "https://www.google.com/maps/search/?api=1&query=Sumiku+Takayama" }
                    ]
                }
            ]},
            { 
                day: 5, 
                date: "12/26 (五)", 
                title: "前往富山、冰見:立山絕景與冰見寒鰤", 
                events: [
                { time: "07:40", title: "高山 → 富山", type: "transport", desc: "搭乘 JR 高山本線前往富山", icon: "fa-train", link: "https://www.google.com/maps/dir/%E9%AB%98%E5%B1%B1%E5%B8%82+%E6%97%A5%E6%9C%AC%E5%B2%90%E9%98%9C%E7%B8%A3/%E6%97%A5%E6%9C%AC%E5%AF%8C%E5%B1%B1%E7%B8%A3%E5%AF%8C%E5%B1%B1%E5%B8%82+Meirincho,+1,+%E5%AF%8C%E5%B1%B1/@36.44244,136.739704,10z/am=t/data=!4m18!4m17!1m5!1m1!1s0x6002a342a14fc349:0xd4f2fb84f0b8e3dc!2m2!1d137.252159!2d36.1461317!1m5!1m1!1s0x5ff7909c5b203e79:0xfd2e8dbcd4fdb276!2m2!1d137.2126258!2d36.7018268!2m3!6e0!7e2!8j1766734800!3e3?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
                { time: "10:05", title: "抵達富山 & 寄放行李", type: "stay", desc: "富山車站內寄放", icon: "fa-suitcase", link: "https://www.google.com/maps/place/%E5%AF%8C%E5%B1%B1/@36.6982846,137.2098071,16.75z/data=!4m6!3m5!1s0x5ff7909c5b203e79:0xfd2e8dbcd4fdb276!8m2!3d36.7018268!4d137.2126258!16s%2Fm%2F025zfy3?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
                { time: "10:30", title: "星巴克 富山環水公園店", type: "spot", desc: "世界最美星巴克之一", icon: "fa-mug-hot", link: "https://www.google.com/maps/search/?api=1&query=Starbucks+Kansui+Park" },
                { time: "11:30", title: "富山市玻璃美術館", type: "spot", desc: "隈研吾設計建築，欣賞玻璃藝術", icon: "fa-gem", link: "https://www.google.com/maps/search/?api=1&query=Toyama+Glass+Art+Museum" },
                { time: "12:30", title: "午餐: 新とんかつ (Shin Tonkatsu)", type: "food", desc: "老字號日式炸豬排", icon: "fa-utensils", link: "https://www.google.com/maps/place/Shin+Tonkatsu/@36.6886361,137.2111454,17.5z/data=!3m1!5s0x5ff7908a8793cf17:0xa1f51866f64fee69!4m6!3m5!1s0x5ff7908a63f855e3:0x900537d5a13c5e7!8m2!3d36.6893625!4d137.2140511!16s%2Fg%2F1tcz851s?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
                { time: "14:30", title: "前往雨晴海岸", type: "transport", desc: "搭乘電車與JR冰見線前往", icon: "fa-train", link: "https://www.google.com/maps/dir/%E6%96%B0%E3%81%A8%E3%82%93%E3%81%8B%E3%81%A4%E7%B7%8F%E6%9B%B2%E8%BC%AA%E5%BA%97/%E9%9B%A8%E6%99%B4%E6%B5%B7%E5%B2%B8/@36.7594519,137.0228249,12z/am=t/data=!4m18!4m17!1m5!1m1!1s0x5ff7908a63f855e3:0x900537d5a13c5e7!2m2!1d137.2140511!2d36.6893625!1m5!1m1!1s0x5ff777c360d22897:0x2a10f941cf8fac42!2m2!1d137.0420588!2d36.8148693!2m3!6e0!7e2!8j1766757600!3e3?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
                { time: "15:30", title: "雨晴海岸", type: "spot", desc: "眺望立山連峰的絕景", icon: "fa-camera", link: "https://www.google.com/maps/search/?api=1&query=Amaharashi+Coast" },
                { time: "16:43", title: "前往冰見住宿", type: "transport", desc: "JR冰見線或計程車前往海風", icon: "fa-taxi", link: "https://www.google.com/maps/dir/%E9%9B%A8%E6%99%B4+Shibuya,+Takaoka,+Toyama+933-0136%E6%97%A5%E6%9C%AC/%E6%B5%B7%E9%A2%A8%E3%80%9Cnami+no+oto%E3%80%9C/@36.8342006,136.991725,14z/am=t/data=!4m18!4m17!1m5!1m1!1s0x5ff7769d33853ea1:0xa94c3a8ee9881657!2m2!1d137.0374292!2d36.8164932!1m5!1m1!1s0x5ff773ebb32cbc75:0x3f14d288d1029e2d!2m2!1d136.9922816!2d36.8509724!2m3!6e0!7e2!8j1766767380!3e3?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
                { time: "17:15", title: "Check-in: 海風〜nami no oto〜", type: "stay", desc: "冰見海景民宿", icon: "fa-bed", link: "https://www.google.com/maps/place/%E6%B5%B7%E9%A2%A8%E3%80%9Cnami+no+oto%E3%80%9C/@36.8500122,136.9865966,15.5z/data=!4m14!1m7!3m6!1s0x5ff773ebb32cbc75:0x3f14d288d1029e2d!2z5rW36aKo44CcbmFtaSBubyBvdG_jgJw!8m2!3d36.8509456!4d136.9921995!16s%2Fg%2F11y22c_zq4?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
                { 
                    type: "choice", 
                    dayKey: "day5",
                    time: "18:30",
                    title: "晚餐選擇 (互動式)",
                    options: [
                        { id: "option1", name: "ばんや料理 ひみ浜", desc: "米其林推薦，必吃冰見寒鰤魚三吃", price: 11000, link: "https://www.google.com/maps/search/?api=1&query=Banya+Ryori+Himihama" },
                        { id: "option2", name: "亀寿し (Kame Sushi)", desc: "在地人氣壽司店，新鮮富山灣海鮮", price: 5000, link: "https://www.google.com/maps/place/Kame+Sushi/@36.8499807,136.9855586,15z/data=!4m6!3m5!1s0x5ff773d19ae0de3b:0x6dca221d3bfeff51!8m2!3d36.851879!4d136.986278!16s%2Fg%2F1tdcg6gq?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" }
                    ]
                }
            ]},
            { 
                day: 6, 
                date: "12/27 (六)", 
                title: "前往白川: 童話世界合掌村", 
                events: [
                { time: "08:16", title: "冰見→ 白川鄉", type: "transport", desc: "冰見出發，經高岡轉乘加越能巴士", icon: "fa-bus", link: "https://www.google.com/maps/dir/%E6%97%A5%E6%9C%AC%E3%80%92935-0014+Toyama,+Himi,+Jizomachi,+14%E2%88%923+%E6%B5%B7%E9%A2%A8%E3%80%9Cnami+no+oto%E3%80%9C/%E6%97%A5%E6%9C%AC%E5%B2%90%E9%98%9C%E7%B8%A3%E7%99%BD%E5%B7%9D%E6%9D%91+Ogimachi,+%E6%BF%83%E9%A3%9B%E9%AB%98%E9%80%9F%E5%B7%B4%E5%A3%AB%E7%99%BD%E5%B7%9D%E9%84%89%E7%AB%99/@36.5569772,136.6004002,10z/am=t/data=!4m19!4m18!1m5!1m1!1s0x5ff773ebb32cbc75:0x3f14d288d1029e2d!2m2!1d136.9922816!2d36.8509724!1m5!1m1!1s0x5ff871bf73091d2b:0x8bf8ff172aba4875!2m2!1d136.9068379!2d36.2619348!2m4!4e4!6e0!7e2!8j1766823300!3e3?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
                { time: "11:00", title: "抵達白川鄉", type: "spot", desc: "世界遺產合掌村散策", icon: "fa-snowflake", link: "https://www.google.com/maps/place/%E6%BF%83%E9%A3%9B%E9%AB%98%E9%80%9F%E5%B7%B4%E5%A3%AB%E7%99%BD%E5%B7%9D%E9%84%89%E7%AB%99/@36.2598685,136.9039391,17z/data=!4m15!1m8!3m7!1s0x5ff8707e4843cc7f:0x56043544d4617173!2z5pel5pys5bKQ6Zic57ij5aSn6YeO6YOh55m95bed5p2R!3b1!8m2!3d36.2710289!4d136.8985744!16zL20vMDM3bXZk!3m5!1s0x5ff871bf73091d2b:0x8bf8ff172aba4875!8m2!3d36.2619463!4d136.9068852!16s%2Fg%2F11c1s537rk?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
                { time: "12:30", title: "午餐: たなか屋 (Tanaka-ya)", type: "food", desc: "品嚐在地蕎麥麵與鄉土料理", icon: "fa-utensils", link: "https://www.google.com/maps/place/Tanaka-ya/@36.2583516,136.9065519,17z/data=!3m1!4b1!4m6!3m5!1s0x5ff871bbea4f3923:0x9af7070cd011ddad!8m2!3d36.258349!4d136.908083!16s%2Fg%2F1vfp81jb?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
                { time: "14:00", title: "下午茶: 落人 (Ochudo)", type: "food", desc: "圍坐在傳統的下沉式火爐（irori）旁喝白玉紅豆湯", icon: "fa-mug-hot", link: "https://www.google.com/maps/search/?api=1&query=Ochudo+Shirakawago" },
                { time: "15:10", title: "白川鄉 → 金澤", type: "transport", desc: "搭乘高速巴士直達金澤 (不需轉乘新幹線)", icon: "fa-bus", link: "https://www.google.com/maps/dir/%E6%BF%83%E9%A3%9B%E9%AB%98%E9%80%9F%E5%B7%B4%E5%A3%AB%E7%99%BD%E5%B7%9D%E9%84%89%E7%AB%99+%E6%97%A5%E6%9C%AC%E3%80%92501-5627+Gifu,+Ono+District,+Shirakawa,+Ogimachi,+1086/%E9%87%91%E6%B2%A2%E9%A7%85+%E6%97%A5%E6%9C%AC%E3%80%92920-0858+Ishikawa,+Kanazawa,+Kinoshinbomachi,+1%E7%95%AA1%E5%8F%B7/@36.4312521,136.6340632,10z/am=t/data=!4m14!4m13!1m5!1m1!1s0x5ff871bf73091d2b:0x8bf8ff172aba4875!2m2!1d136.9068852!2d36.2619463!1m5!1m1!1s0x5ff8336336e8909d:0xc264906f3531d044!2m2!1d136.6480572!2d36.5780518!3e3?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
                { time: "16:35", title: "抵達金澤站", type: "transport", desc: "前往飯店 Check-in", icon: "fa-map-pin", link: "https://www.google.com/maps/place/Kanazawa+Station/@36.578044,136.6482606,17z/data=!3m1!4b1!4m6!3m5!1s0x5ff8336336e8909d:0xc264906f3531d044!8m2!3d36.578044!4d136.6482606!16zL20vMGJibXF4?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
                { time: "17:15", title: "Check-in", type: "stay", desc: "清蓮 Le Lotus Bleu (金澤)", icon: "fa-bed", link: "https://www.google.com/maps/search/?api=1&query=Le+Lotus+Bleu+Kanazawa" },
                { time: "19:30", title: "晚餐: 能登牛燒肉 味道苑 大手町(Midouen)", type: "food", desc: "品嚐頂級能登牛燒肉", icon: "fa-utensils", link: "https://www.google.com/maps/place/Midouen/@36.5686093,136.6547276,14.88z/data=!4m6!3m5!1s0x5ff83376d8e98d3b:0x5edec75734796297!8m2!3d36.5695417!4d136.6609552!16s%2Fg%2F1tj7w71s?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" }
            ]},
            { 
                day: 7, 
                date: "12/28 (日)", 
                title: "金澤經典名所", 
                events: [
                { time: "09:00", title: "兼六園", type: "spot", desc: "日本三大名園", icon: "fa-tree", link: "https://www.google.com/maps/search/?api=1&query=Kenrokuen" },
                { time: "11:30", title: "東茶屋街", type: "spot", desc: "金箔冰淇淋、懷舊街景", icon: "fa-fan", link: "https://www.google.com/maps/search/?api=1&query=Higashi+Chaya+District" },
                { time: "13:00", title: "午餐: 近江町市場海鮮丼", type: "food", desc: "近江町食堂或井之彌", icon: "fa-fish", link: "https://www.google.com/maps/search/?api=1&query=Omicho+Market" },
                { time: "15:30", title: "點心: 石川屋本舖", type: "food", desc: "琥珀糖", icon: "fa-gift" },
                { time: "18:30", title: "晚餐: 赤玉本店", type: "food", desc: "金澤特色關東煮", icon: "fa-mug-hot", link: "https://www.google.com/maps/search/?api=1&query=Akadama+Honten+Kanazawa" }
            ]},
            { 
                day: 8, 
                date: "12/29 (一)", 
                title: "金澤武士與返程", 
                events: [
                { time: "09:30", title: "長町武家屋敷跡", type: "spot", desc: "武士住宅區", icon: "fa-house-chimney-user", link: "https://www.google.com/maps/search/?api=1&query=Nagamachi+Bukeyashiki" },
                { time: "11:00", title: "尾山神社", type: "spot", desc: "特色神門", icon: "fa-torii-gate", link: "https://www.google.com/maps/search/?api=1&query=Oyama+Shrine" },
                { time: "13:00", title: "午餐: 手打蕎麥麵 YABUDA", type: "food", desc: "金澤車站附近", icon: "fa-bowl-food", link: "https://www.google.com/maps/search/?api=1&query=YABUDA+Kanazawa" },
                { time: "15:00", title: "金澤 → 名古屋", type: "transport", desc: "JR 特急 Shirasagi", icon: "fa-train" },
                { time: "18:00", title: "Check-in", type: "stay", desc: "Compass Hotel Nagoya", icon: "fa-bed", link: "https://www.google.com/maps/search/?api=1&query=Compass+Hotel+Nagoya" },
                { time: "20:00", title: "晚餐: 矢場味噌豬排", type: "food", desc: "名古屋名物", icon: "fa-utensils", link: "https://www.google.com/maps/search/?api=1&query=Yabaton+Nagoya" }
            ]},
            { 
                day: 9, 
                date: "12/30 (二)", 
                title: "名古屋市區與購物", 
                events: [
                { time: "10:30", title: "大須觀音 & 商店街", type: "spot", desc: "逛街、參拜", icon: "fa-store", link: "https://www.google.com/maps/search/?api=1&query=Osu+Kannon" },
                { time: "13:00", title: "午餐: 馬喰一代 名古屋EAST", type: "food", desc: "飛驒牛燒肉午間套餐", icon: "fa-fire", link: "https://www.google.com/maps/search/?api=1&query=Bakuroichidai+Nagoya+East" },
                { time: "14:30", title: "名站周邊購物", type: "spot", desc: "高島屋、電器行", icon: "fa-bag-shopping" },
                { time: "18:30", title: "晚餐: 仙石すし 本店", type: "food", desc: "高CP值壽司", icon: "fa-fish", link: "https://www.google.com/maps/search/?api=1&query=Sengoku+Sushi+Honten" }
            ]},
            { 
                day: 10, 
                date: "12/31 (三)", 
                title: "回程", 
                events: [
                { time: "12:00", title: "午餐: 名古屋車站周邊", type: "food", desc: "最後一餐", icon: "fa-utensils" },
                { time: "15:30", title: "前往機場", type: "transport", desc: "名鐵 μ-SKY", icon: "fa-train" },
                { time: "19:40", title: "搭機返台", type: "transport", desc: "台灣虎航 IT269", icon: "fa-plane" }
            ]}
        ];

        const restaurants = [
            // Nagoya
            { name: "コーヒーハウス かこ", type: "sweet", city: "nagoya", desc: "小倉吐司", link: "https://www.google.com/maps/search/?api=1&query=Coffee+House+Kako" },
            { name: "熱田蓬萊軒", type: "main", city: "nagoya", desc: "鰻魚飯三吃", link: "https://www.google.com/maps/search/?api=1&query=Atsuta+Houraiken" },
            { name: "仙石すし 本店", type: "main", city: "nagoya", desc: "厚切壽司", link: "https://www.google.com/maps/search/?api=1&query=Sengoku+Sushi" },
            { name: "麵屋獅子丸", type: "main", city: "nagoya", desc: "雞白湯拉麵", link: "https://www.google.com/maps/search/?api=1&query=Menya+Shishimaru" },
            { name: "矢場味噌豬排", type: "main", city: "nagoya", desc: "味噌豬排", link: "https://www.google.com/maps/search/?api=1&query=Yabaton" },
            { name: "馬喰一代", type: "main", city: "nagoya", desc: "飛驒牛燒肉", link: "https://www.google.com/maps/search/?api=1&query=Bakuroichidai" },
            { name: "ふみ屋", type: "main", city: "nagoya", desc: "居酒屋", link: "https://www.google.com/maps/search/?api=1&query=Fumiya+Nishiki" },
            // Takayama
            { name: "味藏天國", type: "main", city: "takayama", desc: "JA直營燒肉", link: "https://www.google.com/maps/search/?api=1&query=Ajikura+Tengoku" },
            { name: "丸明", type: "main", city: "takayama", desc: "飛驒牛專賣", link: "https://www.google.com/maps/search/?api=1&query=Maruaki+Takayama" },
            { name: "重兵衛", type: "sweet", city: "takayama", desc: "飛驒牛握壽司", link: "https://www.google.com/maps/search/?api=1&query=Jyubei+Takayama" },
            { name: "林盛堂", type: "sweet", city: "takayama", desc: "玉天點心", link: "https://www.google.com/maps/search/?api=1&query=Rinseido" },
            { name: "えび八", type: "main", city: "takayama", desc: "天婦羅", link: "https://www.google.com/maps/search/?api=1&query=Ebiya+Takayama" },
            { name: "寿美久", type: "main", city: "takayama", desc: "手打蕎麥麵", link: "https://www.google.com/maps/search/?api=1&query=Sumiku+Takayama" },
            // Toyama/Himi (Updated)
            { name: "新とんかつ (Shin Tonkatsu)", type: "main", city: "toyama", desc: "老字號日式炸豬排", link: "https://www.google.com/maps/place/Shin+Tonkatsu/@36.6886361,137.2111454,17.5z/data=!3m1!5s0x5ff7908a8793cf17:0xa1f51866f64fee69!4m6!3m5!1s0x5ff7908a63f855e3:0x900537d5a13c5e7!8m2!3d36.6893625!4d137.2140511!16s%2Fg%2F1tcz851s?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
            { name: "ばんや料理 ひみ浜", type: "main", city: "toyama", desc: "米其林推薦，必吃冰見寒鰤魚三吃", link: "https://www.google.com/maps/search/?api=1&query=Banya+Ryori+Himihama" },
            { name: "亀寿し (Kame Sushi)", type: "main", city: "toyama", desc: "在地人氣壽司店，新鮮富山灣海鮮", link: "https://www.google.com/maps/place/Kame+Sushi/@36.8499807,136.9855586,15z/data=!4m6!3m5!1s0x5ff773d19ae0de3b:0x6dca221d3bfeff51!8m2!3d36.851879!4d136.986278!16s%2Fg%2F1tdcg6gq?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" },
            // Kanazawa
            { name: "石川屋本舖", type: "sweet", city: "kanazawa", desc: "琥珀糖", link: "https://www.google.com/maps/search/?api=1&query=Ishikawaya+Honpo" },
            { name: "近江町食堂", type: "main", city: "kanazawa", desc: "海鮮丼", link: "https://www.google.com/maps/search/?api=1&query=Omicho+Shokudo" },
            { name: "赤玉本店", type: "main", city: "kanazawa", desc: "關東煮", link: "https://www.google.com/maps/search/?api=1&query=Akadama+Honten" },
            { name: "能登牛燒肉 味道苑", type: "main", city: "kanazawa", desc: "頂級能登牛燒肉", link: "https://www.google.com/maps/place/Midouen/@36.5686093,136.6547276,14.88z/data=!4m6!3m5!1s0x5ff83376d8e98d3b:0x5edec75734796297!8m2!3d36.5695417!4d136.6609552!16s%2Fg%2F1tj7w71s?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" }
        ];

        function calculateTotalBudget() {
            // Accommodation
            const accommodationCost = COSTS.ACCOMMODATION;

            // Transport (All Group Total)
            const transport1 = GROUP_SIZE * 2 * COSTS.TRANSPORT.NGO_NAGOYA * JPY_TWD_RATE; 
            const transport2 = GROUP_SIZE * 1 * COSTS.TRANSPORT.NAGOYA_TAKAYAMA * JPY_TWD_RATE;
            const transport3 = GROUP_SIZE * 1 * COSTS.TRANSPORT.TAKAYAMA_TOYAMA * JPY_TWD_RATE;
            const transport4 = GROUP_SIZE * 1 * COSTS.TRANSPORT.TOYAMA_LOCAL * JPY_TWD_RATE;
            const transport5 = GROUP_SIZE * 1 * COSTS.TRANSPORT.TAKAOKA_SHIRAKAWA * JPY_TWD_RATE;
            const transport6 = GROUP_SIZE * 1 * COSTS.TRANSPORT.SHIRAKAWA_KANAZAWA * JPY_TWD_RATE;
            const transport7 = GROUP_SIZE * 1 * COSTS.TRANSPORT.KANAZAWA_NAGOYA * JPY_TWD_RATE;
            const totalTransport = transport1 + transport2 + transport3 + transport4 + transport5 + transport6 + transport7;

            // Dining
            let totalDiningJPY = 0;
            // Add fixed meals
            for (let key in COSTS.DINING) {
                if(key !== "GENERAL_MEAL_LIGHT" && key !== "GENERAL_MEAL_STANDARD") {
                    totalDiningJPY += COSTS.DINING[key];
                }
            }
            // Add General Meals
            totalDiningJPY += (5 * COSTS.DINING.GENERAL_MEAL_STANDARD);
            
            // Add Choice Meals
            const day3ChoiceCost = COSTS.OPTIONS.day3[userChoices.day3];
            const day4ChoiceCost = COSTS.OPTIONS.day4[userChoices.day4];
            const day5ChoiceCost = COSTS.OPTIONS.day5[userChoices.day5];
            totalDiningJPY += day3ChoiceCost;
            totalDiningJPY += day4ChoiceCost;
            totalDiningJPY += day5ChoiceCost;
            
            const totalDining = GROUP_SIZE * totalDiningJPY * JPY_TWD_RATE;

            // Entry - Updated removing Hida Folk Village
            const totalEntryJPY = COSTS.ENTRY.犬山城 + COSTS.ENTRY.德川園 + COSTS.ENTRY.高山陣屋 + COSTS.ENTRY.飛驒之里 + COSTS.ENTRY.兼六園 + COSTS.ENTRY.TOYAMA_GLASS;
            const totalEntry = GROUP_SIZE * totalEntryJPY * JPY_TWD_RATE;

            return {
                Accommodation: Math.round(accommodationCost),
                Transport: Math.round(totalTransport),
                Dining: Math.round(totalDining),
                Entry: Math.round(totalEntry),
                Total: Math.round(accommodationCost + totalTransport + totalDining + totalEntry)
            };
        }

        // Handle User Choice Selection
        window.selectChoice = function(dayKey, optionId) {
            userChoices[dayKey] = optionId;
            // 點擊選擇時，確保當天的狀態被記錄為「展開」(以防它不在 Set 裡)
            // 因為是 UI 互動觸發，一定是展開狀態下才能點擊，但保險起見我們不依賴 renderItinerary 來修改 Set
            renderItinerary(); // Re-render to update selected state UI
            updateChart(); // Update budget chart
        };

        function updateChart() {
            const budget = calculateTotalBudget();
            document.getElementById('total-budget-display').innerHTML = `<i class="fa-solid fa-coins mr-1 theme-teal"></i> 預估總花費約 **$${budget.Total.toLocaleString()} TWD** (不含機票與個人購物)。`;
            document.getElementById('total-entry-display').innerText = `$${budget.Entry.toLocaleString()} TWD`;

            if (chartInstance) {
                chartInstance.data.datasets[0].data = [budget.Accommodation, budget.Transport, budget.Dining, budget.Entry];
                chartInstance.update();
            }
        }

        function renderItinerary() {
            const container = document.getElementById('full-itinerary-container');
            container.innerHTML = itineraryData.map((day, index) => {
                // 根據 openedDays Set 決定顯示狀態
                const isHidden = !openedDays.has(index);
                const hiddenClass = isHidden ? 'hidden' : '';
                const iconClass = isHidden ? '' : 'rotate-180';

                return `
                <div class="timeline-node bg-white p-6 rounded-xl shadow-lg border-t-4 border-[#14B8A6] transition duration-300 ease-in-out hover:shadow-xl group">
                    <div class="flex justify-between items-center cursor-pointer" onclick="toggleAccordion(${index})">
                        <h3 class="text-xl font-bold text-gray-800 flex items-center">
                            <span class="bg-teal-100 theme-teal px-3 py-1 rounded-full text-base font-semibold mr-3">Day ${day.day}</span>
                            ${day.date} - ${day.title}
                        </h3>
                        <i id="icon-${index}" class="fa-solid fa-chevron-down text-gray-500 transition duration-300 ${iconClass}"></i>
                    </div>
                    <div id="content-${index}" class="mt-4 ${hiddenClass} overflow-hidden transition-all duration-500 ease-in-out">
                        <div class="relative pl-6 pt-4">
                            <div class="absolute left-8 top-0 bottom-0 w-0.5 bg-gray-200 timeline-line"></div>
                            ${day.events.map(event => {
                                if (event.type === 'choice') {
                                    return `
                                    <div class="relative flex flex-col mb-6 last:mb-0 ml-10">
                                        <div class="flex items-center space-x-3 mb-3">
                                            <span class="text-sm font-mono text-gray-600 bg-gray-100 px-2 py-0.5 rounded">${event.time}</span>
                                            <h4 class="font-semibold text-gray-800">${event.title}</h4>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            ${event.options.map(opt => {
                                                const isSelected = userChoices[event.dayKey] === opt.id;
                                                return `
                                                <div onclick="selectChoice('${event.dayKey}', '${opt.id}')" 
                                                     class="choice-card p-4 rounded-lg cursor-pointer flex flex-col justify-between ${isSelected ? 'selected' : 'bg-gray-50 hover:bg-gray-100'}">
                                                    <div>
                                                        <div class="flex justify-between items-center mb-1">
                                                            <h5 class="font-bold text-[#334155]">${opt.name}</h5>
                                                            ${isSelected ? '<i class="fa-solid fa-circle-check text-teal-500 text-lg"></i>' : '<i class="fa-regular fa-circle text-gray-400 text-lg"></i>'}
                                                        </div>
                                                        <p class="text-xs text-gray-500 mb-2">${opt.desc}</p>
                                                        <p class="text-sm font-semibold text-gray-700">約 ${opt.price} JPY</p>
                                                    </div>
                                                    <a href="${opt.link}" target="_blank" onclick="event.stopPropagation()" class="text-blue-500 hover:text-blue-700 text-xs font-medium mt-3 inline-block">
                                                        <i class="fa-solid fa-location-dot mr-1"></i>Google Maps
                                                    </a>
                                                </div>
                                                `;
                                            }).join('')}
                                        </div>
                                    </div>
                                    `;
                                } else {
                                    return `
                                    <div class="relative flex items-start mb-6 last:mb-0">
                                        <div class="flex-shrink-0 w-6 h-6 rounded-full ${getIconColor(event.type)} flex items-center justify-center border-4 border-white z-10 absolute left-5 -top-1">
                                            <i class="fa-solid ${event.icon} text-xs"></i>
                                        </div>
                                        <div class="ml-10 pt-0.5">
                                            <div class="flex items-center space-x-3 mb-1">
                                                <span class="text-sm font-mono text-gray-600 bg-gray-100 px-2 py-0.5 rounded">${event.time}</span>
                                                <h4 class="font-semibold text-gray-800">${event.title}</h4>
                                            </div>
                                            <p class="text-sm text-gray-500">${event.desc}</p>
                                            ${event.link ? `<a href="${event.link}" target="_blank" class="text-blue-500 hover:text-blue-700 text-sm font-medium mt-1 inline-block"><i class="fa-solid fa-location-dot mr-1"></i>Google Maps</a>` : ''}
                                        </div>
                                    </div>
                                    `;
                                }
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
            }).join('');
        }

        function getIconColor(type) {
            switch(type) {
                case 'transport': return 'bg-blue-100 text-blue-600';
                case 'food': return 'bg-orange-100 text-orange-600';
                case 'stay': return 'bg-yellow-100 text-yellow-600';
                case 'spot': return 'bg-green-100 text-green-600';
                default: return 'bg-gray-100 text-gray-600';
            }
        }

        function renderRestaurants(filter) {
            const container = document.getElementById('restaurant-grid');
            const filtered = filter === 'all' 
                ? restaurants 
                : restaurants.filter(r => r.city === filter || (filter === 'main' && r.type === 'main') || (filter === 'sweet' && r.type === 'sweet'));

            container.innerHTML = filtered.map(r => {
                let badgeColor = '';
                let cityLabel = '';
                if(r.city === 'nagoya') { badgeColor = 'bg-blue-100 text-blue-800'; cityLabel = '名古屋'; }
                else if(r.city === 'takayama') { badgeColor = 'bg-yellow-100 text-yellow-800'; cityLabel = '高山'; }
                else if(r.city === 'toyama') { badgeColor = 'bg-indigo-100 text-indigo-800'; cityLabel = '富山/冰見'; }
                else { badgeColor = 'bg-green-100 text-green-800'; cityLabel = '金澤'; }

                let typeIcon = r.type === 'main' ? 'fa-utensils' : 'fa-cookie-bite';
                
                return `
                <div class="bg-white rounded-xl shadow-md hover:shadow-xl transition p-6 border border-gray-100 flex flex-col justify-between">
                    <div>
                        <div class="flex justify-between items-start mb-3">
                            <span class="text-xs font-bold px-3 py-1 rounded-full ${badgeColor}">${cityLabel}</span>
                            <span class="text-gray-400"><i class="fa-solid ${typeIcon}"></i></span>
                        </div>
                        <h4 class="font-extrabold text-xl text-gray-800 mb-2">${r.name}</h4>
                        <p class="text-sm text-gray-600">${r.desc}</p>
                    </div>
                    <a href="${r.link}" target="_blank" class="mt-5 text-center block w-full py-2 bg-teal-50 hover:bg-teal-100 text-[#14B8A6] text-sm font-semibold rounded-lg transition">
                        <i class="fa-solid fa-map-location-dot mr-1"></i> 立即導航
                    </a>
                </div>
                `;
            }).join('');
        }

        // 更新 toggleAccordion 邏輯以使用 Set
        window.toggleAccordion = function(index) {
            const content = document.getElementById(`content-${index}`);
            const icon = document.getElementById(`icon-${index}`);
            
            // 檢查並切換狀態
            if (openedDays.has(index)) {
                openedDays.delete(index); // 從 Set 移除
                content.classList.add('hidden');
                icon.classList.remove('rotate-180');
            } else {
                openedDays.add(index); // 加入 Set
                content.classList.remove('hidden');
                icon.classList.add('rotate-180');
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            renderItinerary();
            renderRestaurants('all');

            const btn = document.getElementById('mobile-menu-btn');
            const menu = document.getElementById('mobile-menu');
            btn.addEventListener('click', () => menu.classList.toggle('hidden'));

            const filterBtns = document.querySelectorAll('#food .filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    filterBtns.forEach(b => {
                        b.classList.remove('bg-[#14B8A6]', 'text-white', 'shadow-md');
                        b.classList.add('bg-white', 'text-gray-600', 'border-gray-300', 'hover:bg-teal-50');
                    });
                    e.target.classList.remove('bg-white', 'text-gray-600', 'border-gray-300', 'hover:bg-teal-50');
                    e.target.classList.add('bg-[#14B8A6]', 'text-white', 'shadow-md');
                    renderRestaurants(e.target.getAttribute('data-filter'));
                });
            });

            // Init Charts
            const budget = calculateTotalBudget();
            document.getElementById('total-budget-display').innerHTML = `<i class="fa-solid fa-coins mr-1 theme-teal"></i> 預估總花費約 **$${budget.Total.toLocaleString()} TWD** (不含機票與個人購物)。`;
            document.getElementById('total-entry-display').innerText = `$${budget.Entry.toLocaleString()} TWD`;

            const ctxBudget = document.getElementById('budgetChart').getContext('2d');
            chartInstance = new Chart(ctxBudget, {
                type: 'bar',
                data: {
                    labels: ['住宿', '交通', '餐飲', '門票'],
                    datasets: [{
                        label: '費用估算 (TWD)',
                        data: [budget.Accommodation, budget.Transport, budget.Dining, budget.Entry],
                        backgroundColor: ['#14B8A6', '#3B82F6', '#F59E0B', '#EF4444'],
                        borderRadius: 4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
            });

            new Chart(document.getElementById('timeChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['名古屋-高山', '高山-富山', '富山-白川-金澤', '金澤-名古屋'],
                    datasets: [{
                        label: '預估耗時 (小時)',
                        data: [2.5, 1.5, 5, 3], 
                        backgroundColor: '#14B8A6',
                        borderRadius: 4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
            });
        });
    </script>
</body></html>
